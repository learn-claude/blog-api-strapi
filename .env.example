# ─────────────────────────────────────────────────────────────────────────────
# Blog API Strapi — Environment Variables
# Copy this file to .env and fill in your values.
# NEVER commit .env to version control.
# ─────────────────────────────────────────────────────────────────────────────

# ─── Server ──────────────────────────────────────────────────────────────────
HOST=0.0.0.0
PORT=1337

# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
# Needs 4 comma-separated keys
APP_KEYS=key1_replace_me,key2_replace_me,key3_replace_me,key4_replace_me

# ─── Admin Panel ─────────────────────────────────────────────────────────────
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ADMIN_JWT_SECRET=replace_with_64_char_hex_string
API_TOKEN_SALT=replace_with_random_string
TRANSFER_TOKEN_SALT=replace_with_random_string

# ─── Database — PostgreSQL 16 ────────────────────────────────────────────────
DATABASE_HOST=127.0.0.1
DATABASE_PORT=5432
DATABASE_NAME=blog_api
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=your_postgres_password_here
DATABASE_SSL=false
DATABASE_SCHEMA=public

# Connection pool (optional tuning)
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# SSL certificates (only needed when DATABASE_SSL=true)
# DATABASE_SSL_KEY=
# DATABASE_SSL_CERT=
# DATABASE_SSL_CA=
# DATABASE_SSL_REJECT_UNAUTHORIZED=true

# ─── JWT Authentication (ADR-002) ────────────────────────────────────────────
# Shared secret for development (HS256). In production, use RS256 keys below.
JWT_SECRET=replace_with_strong_random_secret

# Access token lifetime (default: 15 minutes per ADR-002)
JWT_ACCESS_TOKEN_EXPIRES_IN=15m

# Refresh token lifetime in days (default: 7 days per ADR-002)
JWT_REFRESH_TOKEN_EXPIRES_DAYS=7

# Rotate refresh token on each use (recommended: true)
ROTATE_REFRESH_TOKENS=true

# ─── RS256 Keys (Production — use Azure Key Vault instead) ───────────────────
# Generate with:
#   openssl genrsa -out private.pem 2048
#   openssl rsa -in private.pem -pubout -out public.pem
# Then paste the single-line PEM (replace newlines with \n)
JWT_PRIVATE_KEY=
JWT_PUBLIC_KEY=

# ─── CORS ────────────────────────────────────────────────────────────────────
# Comma-separated list of allowed origins
CORS_ORIGIN=http://localhost:3000,http://localhost:4040

# ─── Email (OTP delivery) ────────────────────────────────────────────────────
EMAIL_FROM=noreply@blogplatform.example.com
EMAIL_FROM_NAME=Blog Platform
EMAIL_REPLY_TO=support@blogplatform.example.com

# Email provider: "nodemailer" (default, local dev) or "sendgrid" (staging/production)
EMAIL_PROVIDER=nodemailer

# --- nodemailer (local dev) ---
# Leave blank to use Ethereal (https://ethereal.email) — preview emails in browser
# Or point at a local SMTP server (e.g. Mailhog: SMTP_HOST=localhost SMTP_PORT=1025)
SMTP_HOST=smtp.ethereal.email
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=

# --- SendGrid (staging/production, requires EMAIL_PROVIDER=sendgrid) ---
SENDGRID_API_KEY=SG.replace_with_your_sendgrid_api_key

# ─── Apple Sign-In (ADR-003) ─────────────────────────────────────────────────
# From Apple Developer Console → Certificates, Identifiers & Profiles
APPLE_TEAM_ID=XXXXXXXXXX
APPLE_KEY_ID=XXXXXXXXXX
# Services ID (Web) — e.g. com.example.blogplatform.web
APPLE_SERVICES_ID=com.example.blogplatform.web
# Bundle ID (iOS) — e.g. com.example.blogplatform
APPLE_BUNDLE_ID=com.example.blogplatform
# P8 private key content (single-line with \n for newlines)
APPLE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\nREPLACE_ME\n-----END PRIVATE KEY-----

# ─── Google Sign-In (ADR-003) ────────────────────────────────────────────────
# From Google Cloud Console → APIs & Services → Credentials
GOOGLE_CLIENT_ID=replace_with_google_oauth_client_id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=replace_with_google_client_secret

# ─── Azure Key Vault (Production) ────────────────────────────────────────────
# Used in production to retrieve secrets securely instead of env vars
AZURE_KEY_VAULT_URL=https://your-keyvault.vault.azure.net/
AZURE_CLIENT_ID=
AZURE_TENANT_ID=
AZURE_CLIENT_SECRET=

# ─── Azure Application Insights (Optional Monitoring) ────────────────────────
# APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=xxx;IngestionEndpoint=https://...

# ─── Feature Flags ───────────────────────────────────────────────────────────
FLAG_NPS=false
FLAG_PROMOTE_EE=false

# ─── Webhooks ────────────────────────────────────────────────────────────────
WEBHOOKS_POPULATE_RELATIONS=false
